@page
@model WarehouseClient.Pages.Receipts.IndexModel
@{
    ViewData["Title"] = "Поступления";
}

<div class="content-wrapper">
    <div class="page-header">
        <h1>Поступления</h1>
    </div>

    <form method="get" class="filters">
        <div class="filter-group">
            <label>Период</label>
            <div style="display: flex; gap: 10px;">
                <input type="date" name="dateFrom" value="@Model.DateFrom?.ToString("yyyy-MM-dd")" />
                <input type="date" name="dateTo" value="@Model.DateTo?.ToString("yyyy-MM-dd")" />
            </div>
        </div>
        
        <div class="filter-group">
            <label>Номера поступлений</label>
            <select name="numbers" multiple asp-items="Model.NumbersList">
                <option value="">-- Все номера --</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>Ресурсы</label>
            <select name="resourceIds" multiple asp-items="Model.ResourcesList">
                <option value="">-- Все ресурсы --</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>Единицы измерения</label>
            <select name="unitIds" multiple asp-items="Model.UnitsList">
                <option value="">-- Все единицы --</option>
            </select>
        </div>
        
        <button type="submit" class="btn btn-primary">Применить</button>
        <a href="/Receipts" class="btn btn-secondary">Сбросить</a>
        <a href="/Receipts/Create" class="btn btn-success">Добавить</a>
    </form>

    <table class="data-table">
        <thead>
            <tr>
                <th>Номер</th>
                <th>Дата</th>
                <th>Ресурс</th>
                <th>Единица измерения</th>
                <th>Количество</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Receipts != null && Model.Receipts.Any())
            {
                @foreach (var receipt in Model.Receipts)
                {
                    @if (receipt.ReceiptResources != null && receipt.ReceiptResources.Any())
                    {
                        @foreach (var resource in receipt.ReceiptResources)
                        {
                            <tr>
                                <td>@receipt.Number</td>
                                <td>@receipt.Date.ToShortDateString()</td>
                                <td>@(resource.Resource?.Name ?? "Неизвестный ресурс")</td>
                                <td>@(resource.Unit?.Name ?? "Неизвестная единица")</td>
                                <td>@resource.Quantity.ToString("N2")</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td>@receipt.Number</td>
                            <td>@receipt.Date.ToShortDateString()</td>
                            <td colspan="3" style="text-align: center; color: #999;">Нет ресурсов</td>
                        </tr>
                    }
                }
            }
            else
            {
                <tr>
                    <td colspan="5" style="text-align: center; color: #999;">Нет данных о поступлениях</td>
                </tr>
            }
        </tbody>
    </table>
</div>